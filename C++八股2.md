# C++中类的大小由什么确定

反应：成员变量的大小以及虚继承的基类的个数，虚继承的话会对虚基类指针指针个数有所影响



标答：

1. 非静态成员变量的大小

    因为如果有静态成员变量的话，他是存储在全局数据区的，不占类的内存大小

   

2. 内存对齐和填充

```c++
#include<iostream>

class B{
	 char c;//1字节   其要填充七个字节
	 double d;//8字节
};
int main(){
	cout<<sizeof(B)<<endl;//输出16
}

```

**原因：**在类中所有的成员变量 他的内存大小必须填充为最大内存的成员变量的数据类型的大小的倍数

3. 虚函数的影响

虚函数表指针嘛，64位系统中虚表指针大小为8字节。

```c
#include <iostream>
using namespace std;
class C{

	virtual void func(){} //引入虚函数指针 8字节
	int x;//4 字节
}

int main(){
	cout<<sizeof(C)<<endl;
}
```

有虚函数指针的话，也要记得类的内存大小必须填充为最大内存成员变量数据类型的大小，也就是一个指针八字节。**注意类中增加的是虚表指针的大小，无论多少的虚函数都无所谓的！！**

所以输出是16字节



![局部截取_20250316_224019](.\Workiong_File\snpi\局部截取_20250316_224019.png)

4. 虚继承的影响

上篇说过了，这个虚继承的话子类中是有保存父类的虚基类指针的



```c++
#include <iostream>
using namespace std;
class Base{
	int a;
}
class Derived: virtual public Base{
	int b;
}
int main(){
		cout<<sizeof(Derived)<<endl;
}
```



Derived虚继承的话会有一个指针Ⅷ字节，那我们想一下，是不是加上基类指针，加上基类成员变量和自身成员变量，内存对齐的话，是不是就是16了呢？

使用vs编辑器的话结果是24 但是用g++编译器的话，输出的就是16.



**那为啥vs编辑器下输出字节数是24呢？**

1. 因为在vs编译器中会有一个基类缓存空间，也就是基类的大小（这里是4字节）

2. vs给父类的缓存空间和**派生类自身大小**(b和虚基类指针)的内存空间不是连续的，两段空间上进行内存对齐

   

![局部截取_20250316_220253](.\Workiong_File\snpi\局部截取_20250316_220253.png)

5. 空类的大小 、

 那空类大小是多少呢？不是0哦，是1.

为什么呢？

在C++中要区别每一个类的地址，那么如果空类大小都是0的话，就没办法区分每一个类的地址了

项目中有多个空类的时候，所以要区分他们就要给每一个空类都占一个字节大小，保存每个空类的存储地址



# 详解虚函数





派生类中存在多个虚函数的时候，访问不同的虚表，this指针需要有不同的偏移