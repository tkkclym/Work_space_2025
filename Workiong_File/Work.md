# Actor Ticking 

TIck 每帧触发一次。Ticked 的顺序是基于`Actor World列表`中的顺序（主要根据Actor在场景中的创建顺序，添加顺序等）进行更新，tick分为三个阶段

三个阶段：异步处理前 异步处理中 异步处理后





## **Actor在何时被调用是根据什么控制的？**

**TickGroup**成员控制。

1. **TG_PreAsyncGroup**: 如果一个Actor需要在任何异步工作之前更新其状态，它将被分配到TG_PreAsyncWork组。如果不是怎可能会造成错误

2. **TG_DuringAsyncGroup**:可以与物理和其他线程并行调用的，被分配到TG_DuringAsyncWork组。如果这个组的任何Actor调用了一个处理刚体物理数据的函数，将log一个错误，并且忽略调用。这可能导致内存泄漏或者无效的场景状态。同样的情况也适用于SpawnActor(),moveActor(),SetLocation(),etc.这些函数会被继续执行，并且不会影响物理线程请问，同时也会打印错误。`也就是说，跟物理模拟等相关的逻辑可和物理逻辑一帧同时处理，但是Actor不要调用物理模拟的相关函数，不然可能会打乱物理模拟计算流程导致某些错误`

3. **TG_PostAsyncGroup**:最后，如果一个actor处于TG_PostAsyncGroup的话，他是依赖物理模拟的结果进行后续逻辑处理的，以便表示模拟后准确的世界状态。这个阶段调用所有与物理相关的函数都是安全的，因为，已经处理完包括物理模拟在内的所有异步信息了，不会感染异步线程中的处理逻辑与数据。

   

   

   ##  **Actor触发被分配至不同组的常用规则：**

   1. 可以改变碰撞的，生成可碰撞的actors的、写入Novodex数据的（这是个啥？）、那么这些Actor应该被放置在TG_PreAsyncWork组。常见的就是pawns、weapon、或者一些刚体类。
   2. 如果这些actor不能改变碰撞，或者生成non-collision的actors的 吗，或者不改变Novodex的。可以将其放在TG_DuringAsyncWork
   3. 如果需要物理引擎返回的数据，那么就是将Actor分在TG_PostAsyncGroup

   Novodex：物理引擎 Novodex data 就是物理引擎数据 

   

   ## **为什么物理模拟属于异步处理？**

   - 提高整体性能：
     - 独立于渲染线程：游戏中的渲染线程主要负责将游戏中场景元素绘制在屏幕，若渲染线程与物理线程放在同一线程同步处理，当物理模拟计算量较大时，占用大量时间，会导致帧率下降，画面卡顿，因此将其单独处理。
     - 与其他逻辑发分离开：游戏中有很多逻辑处理物理和渲染，还有剧情推进，玩家输入，Ai等计算行为。将各部分放在独立线程中处理，能够提高整个游戏的并行性与效率，避免不同逻辑之间的干扰和阻塞。
   - 实现并行计算
     - 如今cpu都是多核心的，将物理模拟作为异步处理，可将其分配到一个或者多个核心进行计算，与其他线程同时运行，充分利用性能
   - 便于管理与控制
     - 通常物理模拟的频率和游戏帧率不同，而且不同的物理场景和物理对象可能需要不同的更新频率，因此将物理模拟作为一部处理，可以方便独立的设置物理模拟的更新频率，根据实际情况进行调整 ，而不会受到部分游戏更新频率影响。
     - 错误处理和恢复：物理模拟过程中可能出现各种错误，如数值计算错误/碰撞检测错误., 异步处理的时候不影响其他游戏进程或者导致崩溃。

## **Attention:**

Actor列表的顺序和该Actor属于什么阶段处理没有联系，就比如一个Actor是PostAsyncGroup的，他也得等物理模拟等异步工作处理完了才被调用.



## Actor 生成：

 生成一个actor的时候，它和其所有组将会在生成时所在的组立即进行更新，而暂时不遵循原本设置的Tick Group规则。从下一帧开始，才会按照其自身的TickGroup组进行设置更新。（因为时被spawn的，所以刚开始的控制权不在与它，在下一帧的时候才夺回控制权）。有一个例外，在异步期间生成的actor会被延迟到TG_postAsync工作阶段。

Component：也会被分到不同更新组中，但是跟随所attach的Actor的更新组



## Tick的步骤：

遍历世界Actors列表，更新是TG_PreAsyncGroup的Actors,延迟其他组Actor的更新

对于更新过的Actors，遍历组件列表来更新TG_PreAsyncGroup中的Actors,延迟其他组Actor的更新(更新了actor上的组件)

-----------

启动物理模拟

更新TG_DuringAsyncGroup中的actors、

对于Actor中的每个组件，根据需要更新延迟的组件

更新延迟至TG_DuringAsyncGroup才更=更新的组件

Block 知道所有物理计算完成

--------------

更新位于TG_PostAsyncWork列表中的每个Actor。

更新Actor中的每个组件

更新每个延迟更新直到TG_PostAsycnWork出现的才进行更新的组件





# ActorComponent



